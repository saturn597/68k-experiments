	; A program that draws by writing directly to the screen buffer.
	
	; For fun, we'll copy a piece of memory from elsewhere into 
	; the screen buffer.
	
	include	'Traps.a'
	include 'ToolEqu.a'

scrnbase equ $824			; pointer to bottom of screen buffer
	
	main
	
Main
	move.l #0, WindowList	; to use events but not windows per "Inside Macintosh", I-255
	
	move.l scrnbase, A0		; dereferences scrnbase

	move.l A7, A1			; start copying from the current stack pointer
	move.w #5000, D1		; initialize loop variable
	
	
Draw
	move.l (A1)+, (A0)+		; move bits to the screen
	dbra D1, Draw			; loop until D1 is -1

	addq #4, SP 			; unwind the stack

	pea -1
	pea 0
	_FlushEvents			; flushEvents(-1, 0) to empty event queue

	;_debugger
	link A6, #-18			; room to hold boolean return val of getNextEvent and the event data
	
Wait
	move.w #-1, -(A7)		; first param for getNextEvent (-1 event mask)
	pea -16(A6)				; next param; event info goes to this address
	_getNextEvent
	
	sub.w #1, -16(A6)		; event type of 1 is mouse down
	bne Wait				; loop until mouse down
	
	unlk A6					; restore stack

	_ExitToShell
	
	end